---
- name: Make sure sudo is available.
  pacman:
    update_cache: "yes"
    name: sudo,docker,git
    state: present
- name: Create a user.
  user:
    name: duchess
    shell: /bin/bash
    home: /home/duchess
    group: docker
    groups: wheel
- name: Add authorized key to new user.
  authorized_key:
    user: duchess
    key: "{{ lookup('file', '/root/.ssh/id_rsa.pub') }}"
    state: present
- name: Set the hostname.
  hostname:
    name: "{{ jenkins_hostname }}"
- name: Copy updated sudoers.
  copy:
    src: sudoers
    dest: /etc/sudoers
- name: Copy updated sshd.
  copy:
    src: "{{ item }}"
    dest: "/etc/ssh/{{ item }}"
  loop:
    - ssh_config
    - sshd_config
- name: Restart sshd service.
  service:
    name: sshd
    state: restarted
- name: Update user group.
  user:
    name: duchess
    groups: docker
    append: "yes"
- name: Copy Docker service.
  copy:
    src: docker.service
    dest: /lib/systemd/system/docker.service
- name: Start Docker daemon.
  service:
    name: docker
    state: started
    enabled: "yes"
- name: Download pip install.
  get_url:
    url: https://bootstrap.pypa.io/get-pip.py
    dest: /tmp/get-pip.py
- name: Install pip.
  command: python /tmp/get-pip.py
- name: Install Docker Python module.
  pip:
    state: present
    name: docker
- name: Create roles directory.
  file:
    dest: /opt/roles/
    owner: duchess
    group: docker
    state: directory
...
